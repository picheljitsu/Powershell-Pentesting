function Get-DCOMSec{
    #https://enigma0x3.net/2017/01/23/lateral-movement-via-dcom-round-2/
    #
    #
    
    foreach($i in $(gwmi win32_dcomapplicationlaunchallowedsetting)){
        $dcom_appid = ((($i.element).split("="))[1]).replace("`"","")
        $dcom_appname = `
        (gwmi win32_dcomapplication | ? {$_.appid -eq $dcom_appid}).name

        #resolve launchaccess sids
        $launch_sid = (($i.setting).split("=")[1]).replace("`"","")
        $launch_sid_obj = New-Object System.Security.Principal.SecurityIdentifier($sid)
        $launch_principal = ($sid_obj.translate([System.Security.Principal.NTAccount])).Value

        #resolve accessallowed sids
        $dcom_accessallowed = `
        (gwmi Win32_DCOMApplicationAccessAllowedSetting | ? {(((($_.element).split("="))[1]).replace("`"","")) -eq $dcom_appid}).

        $sid = New-Object System.Security.Principal.SecurityIdentifier($SID)
        $dcom_launchsetting = `

        $dcomsec = New-Object PSObject
        $dcomsec | Add-Member -Name "AppID" -MemberType NoteProperty -Value $dcom_appid
        $dcomsec | Add-Member -Name "AppName" -MemberType NoteProperty -Value $dcom_appname
        $dcomsec | Add-Member -Name "LaunchAllowedPrincipal" -MemberType NoteProperty -Value "$launch_sid ($launch_principal)"
        $dcomsec | Add-Member -Name "AccessAllowedPrincipal" -MemberType NoteProperty -Value $principal
        [array]$dcomsec
        
        }
    }
